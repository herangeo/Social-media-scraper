{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Success</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #fdfdfd;
            background: linear-gradient(90deg, #C7C5F4, #776BCC);

        }
        h1 {
            color:white;
            text-align: center;
        }
        .button-container {
            text-align: center;
            margin-bottom: 20px;
            margin-top: 80px;
        }
        .handle-button {
            display: inline-block;
            background-color: #776BCC;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            font-size: 16px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            position: relative;
            transition: width 0.3s;
            min-width: 120px;
        }
        /* .delete-button {
            display: none;
            position: absolute;
            right: 5px;
            top: 5px;
            background: transparent;
            border: none;
            cursor: pointer;
        } */
        /* .handle-button:hover {
            width: 100px;
            text-align: start;
        } */
        .handle-button:hover .delete-button {
            display: inline;
        }
        .delete-button img {
            height: 24px;
            vertical-align: middle;
        }
        .search-results {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            list-style-type: none;
            padding: 0;
            margin: 0 auto;
            width: 90%; /* Adjust width as needed */
            max-width: 1200px; /* Maximum width for responsive design */
        }
        .tweet-card {
            flex: 0 0 calc(30% - 20px); /* Adjust width and margins for spacing */
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .tweet-card p {
            margin: 5px 0;
        }
        .tweet-card a {
            color: #1DA1F2;
            text-decoration: none;
        }
        .tweet-card a:hover {
            text-decoration: underline;
        }
        .delete-button {
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
}

.delete-button i {
    color: #f9f9f9; /* or any color you prefer */
    font-size: 16px; /* adjust size as needed */
}
.header {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(90deg, #bab7ec, #776BCC);
        color: white;
        padding: 10px;
        left: -10px;
        width: 100%;
        position: fixed;
        top: 0;
        z-index: 1000;
}
    .header-content {
        text-align: center;
    }
        .header .logo {
            display: inline-block;
            margin: 0 10px;
        }
        .header img {
            vertical-align: middle;
        }

        .header h1 {
        font-size: 2em;
        margin: 0;
    }

    .header p {
        margin: 0;
        font-size: 1em;
    }
@media (max-width: 768px) {
    .header {
        flex-direction: column;
    }

    .logo {
        margin-bottom: 10px;
    }

    .navbar {
        margin-top: 20px;
    }

    .navbar button {
        padding: 8px 12px;
        font-size: 0.9em;
    }
}
@media (max-width: 480px) {
    .header h1 {
        font-size: 1.5em;
    }

    .header p {
        font-size: 0.8em;
    }

    .navbar button {
        padding: 6px 10px;
        font-size: 0.8em;
    }
}
    .navbar {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-evenly;
    width: 100%;
    background: linear-gradient(90deg, #bab7ec, #6a5eca);
        padding: 5px;
    margin-top: 10px;
}
    .navbar button {
    color: white;
    background: none;
    border: none;
    padding: 10px 15px;
    font: inherit;
    cursor: pointer;
    text-decoration: none;
    white-space: nowrap;
}
.navbar button:hover {
    background-color: #ddd;
    color: black;
}
    .navbar button.active {
    background-color: #ddd;
    color: black;
}
.navbar button i {
    margin-right: 5px;
}
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <img src="{% static '/images/mainlogo.png/' %}" alt="Logo" style="width:60px; height:60px;">
        </div>
        <div class="header-content">
            <h1 class="head">SAMAPRAGYA</h1>
            <p>Empowering with Intelligence</p>
        </div>
        <div class="logo">
            <img src="{% static '/images/mainlogo.png/' %}" alt="Logo" style="width:60px; height:60px;">
        </div>
        <div class="navbar">
            <a href="{% url 'fun' %}" class="button">
                <button type="button">
                  <i class="fab fa-twitter"></i> Twitter
                </button>
            </a>
              <a href="{% url 'fun' %}" class="button">
                <button type="button">
                    <i class="fab fa-reddit-alien"></i> Reddit
                </button>
            </a>
            
            <a href="{% url 'fun' %}" class="button">
                <button type="button">
                    <i class="fab fa-youtube"></i> YouTube
                </button>
            </a>
            
            <a href="{% url 'fun' %}" class="button">
                <button type="button">
                    <i class="fas fa-newspaper"></i> News
                </button>
            </a>
            
            <a href="{% url 'fun' %}" class="button">
                <button type="button">
                    <i class="fas fa-play-circle"></i> DailyMotion
                </button>
            </a>
            
            <a href="{% url 'twitter_scraper_form' %}" class="button">
                <button type="button">
                    <i class="fas fa-tv"></i> Live Monitoring
                </button>
            </a>
            
            <a href="{% url 'graph' %}" class="button">
                <button type="button">
                    <i class="fas fa-chart-bar"></i> Graph
                </button>
            </a>
            
            <a href="http://androidcamp.com"  class="button">
                <button type="button">
                    <i class="fas fa-search"></i> Web Search
                </button>
            </a>
            
            <a href="{% url 'index' %}" class="button">
                <button type="button">
                    <i class="fab fa-facebook-f"></i> Facebook
                </button>
            </a>
            
            <a href="{% url 'home' %}"  class="button">
                <button type="button">
                    <i class="fab fa-instagram"></i> Instagram
                </button>
            </a>
            
            <a href="{% url 'medium_scraper' %}"  class="button">
                <button type="button">
                    <i class="fab fa-telegram-plane"></i> Telegram
                </button>
            </a>
            
            <a href="{% url 'fun' %}"  class="button">
                <button type="button">
                    <i class="fas fa-home"></i> Home
                </button>
            </a>
            </div>
    </div>
    
    <h1>SAVED USERNAMES</h1>
    <br>
    <div class="button-container">
        {% for handle in saved_handles %}
            <div class="handle-button" onclick="searchHandle('{{ handle }}')">
                {{ handle }}
                <button class="delete-button" onclick="event.stopPropagation(); deleteHandle('{{ handle }}')">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        {% endfor %}
    </div>
    <br>
    <div id="search-results" class="search-results"></div>
    <script>
        function fetchLatestTweets() {
            fetch("{% url 'fetch_latest_tweets' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Tweets fetched and saved successfully! go check ');
                } else {
                    alert('Error fetching tweets.');
                }
            });
        }

        function deleteHandle(twitterHandle) {
            fetch("{% url 'delete_twitter_handle' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ 'twitter_handle': twitterHandle })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Twitter handle deleted successfully!');
                    location.reload();
                } else {
                    alert('Error deleting Twitter handle.');
                }
            });
        }

        function searchHandle(twitterHandle) {
            fetch("{% url 'search_twitter_handle' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ 'twitter_handle': twitterHandle })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    displaySearchResults(data.tweet_data);
                } else {
                    alert('Tweets are Fetching Wait!.');
                }
            });
        }

        function displaySearchResults(tweets) {
            const resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';

            const seenTweets = new Set();

            tweets.forEach(tweet => {
                const tweetKey = tweet['Date & Time'];

                if (!seenTweets.has(tweetKey)) {
                    seenTweets.add(tweetKey);

                    const tweetCard = document.createElement('div');
                    tweetCard.className = 'tweet-card';

                    tweetCard.innerHTML = `
                        <p><strong>Account:</strong> ${tweet.UserName}</p>
                        <p><strong>Date & Time:</strong> ${tweet['Date & Time']}</p>
                        <p><strong>TweetContent:</strong> ${tweet.TweetContent}</p>
                        <p><strong>Replies:</strong> ${tweet.Replies}</p>
                        <p><strong>Retweets:</strong> ${tweet.Retweets}</p>
                        <p><strong>Likes:</strong> ${tweet.Likes}</p>
                        <p><strong>Views:</strong> ${tweet.Views}</p>
                        <p><strong>TweetURL:</strong> <a href="${tweet.TweetURL}" target="_blank">${tweet.TweetURL}</a></p>
                    `;

                    resultsContainer.appendChild(tweetCard);
                }
            });
        }

        // Set interval to fetch latest tweets every 30 minutes
        setInterval(fetchLatestTweets, 30 * 60 * 1000);
        // Fetch latest tweets when the page loads
        fetchLatestTweets();
    </script>
</body>
</html>
